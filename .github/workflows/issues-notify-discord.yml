name: Issues Notify Discord
on:
  workflow_call:
    inputs:
      triageLabel:
        type: string
        default: needs triage
    secrets:
      discordWebhook:
        required: true

jobs:
  labelNotify:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      issueTitleLink: "[${{ github.event.issue.title }} (#${{ github.event.issue.number }})](<${{github.event.issue.html_url}}>) in ${{github.event.repository.organization}}/${{github.event.repository.name}}"
    steps:
      - name: Overview
        run: |
          echo "Issue action ${{ github.event.action }} for ${{ github.event.issue.title }} (${{github.event.issue.number}}) with labels '${{ join(github.event.issue.labels.*.name, ', ') }}' and changed label '${{github.event.label.name}}'"

      - name: Bug reported
        if: github.event.action == 'opened' && contains(github.event.issue.labels.*.name, 'bug')
        uses: Ilshidur/action-discord@0.4.0
        env:
          DISCORD_WEBHOOK: "${{ secrets.discordWebhook }}"
        with:
          args: "ü™≥ A bug has been reported: ${{env.issueTitleLink}}"

      - name: Enhancement requested
        if: github.event.action == 'opened' && contains(github.event.issue.labels.*.name, 'enhancement')
        uses: Ilshidur/action-discord@0.4.0
        env:
          DISCORD_WEBHOOK: "${{ secrets.discordWebhook }}"
        with:
          args: "üéÅ An enhancement has been requested:  ${{env.issueTitleLink}}"

      - name: Help wanted
        if: github.event.action == 'labeled' && github.event.label.name == 'help wanted'
        uses: Ilshidur/action-discord@0.4.0
        env:
          DISCORD_WEBHOOK: "${{ secrets.discordWebhook }}"
        with:
          args: "üôå Help is wanted:  ${{env.issueTitleLink}}"

      - name: Triaged
        if: github.event.action == 'unlabeled' && github.event.label.name == inputs.triageLabel
        uses: Ilshidur/action-discord@0.4.0
        env:
          DISCORD_WEBHOOK: "${{ secrets.discordWebhook }}"
        with:
          args: "ü©∫ Issue has been triaged:  ${{env.issueTitleLink}}"

      - name: Completed
        if: github.event.action == 'closed' && github.event.issue.state_reason == 'completed'
        uses: Ilshidur/action-discord@0.4.0
        env:
          DISCORD_WEBHOOK: "${{ secrets.discordWebhook }}"
        with:
          args: "üéâ Issue has been resolved:  ${{env.issueTitleLink}}"

